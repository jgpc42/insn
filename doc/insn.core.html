<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>insn.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">insn</span> <span class="project-version">0.5.2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>insn</span></div></div></li><li class="depth-2 branch"><a href="insn.clojure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clojure</span></div></a></li><li class="depth-2 branch current"><a href="insn.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="insn.module.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>module</span></div></a></li><li class="depth-2 branch"><a href="insn.op.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>op</span></div></a></li><li class="depth-2"><a href="insn.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="insn.core.html#var-*bytecode-version*"><div class="inner"><span>*bytecode-version*</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-*class-flags*"><div class="inner"><span>*class-flags*</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-*field-flags*"><div class="inner"><span>*field-flags*</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-*init-flags*"><div class="inner"><span>*init-flags*</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-*method-flags*"><div class="inner"><span>*method-flags*</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-define"><div class="inner"><span>define</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-generate"><div class="inner"><span>generate</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-get-bytes"><div class="inner"><span>get-bytes</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-Loader"><div class="inner"><span>Loader</span></div></a></li><li class="depth-2"><a href="insn.core.html#var-load-type"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>load-type</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-new-instance"><div class="inner"><span>new-instance</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-visit"><div class="inner"><span>visit</span></div></a></li><li class="depth-1"><a href="insn.core.html#var-write"><div class="inner"><span>write</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">insn.core</h1><div class="doc"><pre class="plaintext">Simple JVM bytecode generation.
</pre></div><div class="public anchor" id="var-*bytecode-version*"><h3>*bytecode-version*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">The bytecode version to use for types if unspecified.
</pre></div></div><div class="public anchor" id="var-*class-flags*"><h3>*class-flags*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">The class/interface flags to use if unspecified.
</pre></div></div><div class="public anchor" id="var-*field-flags*"><h3>*field-flags*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">The field flags to use if unspecified.
</pre></div></div><div class="public anchor" id="var-*init-flags*"><h3>*init-flags*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">The constructor flags to use if unspecified.
</pre></div></div><div class="public anchor" id="var-*method-flags*"><h3>*method-flags*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">The method flags to use if unspecified.
</pre></div></div><div class="public anchor" id="var-define"><h3>define</h3><div class="usage"><code>(define t)</code><code>(define cl t)</code></div><div class="doc"><pre class="plaintext">Return a Class object from the provided type.
</pre></div></div><div class="public anchor" id="var-generate"><h3>generate</h3><div class="usage"><code>(generate t)</code></div><div class="doc"><pre class="plaintext">Alias of `visit`.
</pre></div></div><div class="public anchor" id="var-get-bytes"><h3>get-bytes</h3><div class="usage"><code>(get-bytes t)</code></div><div class="doc"><pre class="plaintext">Return a representation of the provided type as an array of bytes.
This array is an in-memory equivalent to a java .class file on disk.</pre></div></div><div class="public anchor" id="var-Loader"><h3>Loader</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-load-type"><h3>load-type</h3><div class="usage"><code>(load-type cl t)</code></div><div class="doc"><pre class="plaintext">Return a class object from the given map containing the class
:bytes and :name.</pre></div></div></div></div></div><div class="public anchor" id="var-new-instance"><h3>new-instance</h3><div class="usage"><code>(new-instance t)</code><code>(new-instance t &amp; args)</code></div><div class="doc"><pre class="plaintext">Define and return an instance of the generated class. The
non-abstract type must define a public constructor that accepts
either no arguments, or if `args` is provided, the given arguments.

If the given argument count matches a constructor with a distinct
arity, that one is invoked. In this case, constructors that take
primitives are supported via reflective unboxing.

Otherwise, the argument types must exactly match (as per
`clojure.core/class`) a defined constructor, or a constructor that
accepts the same amount of `Object`s.</pre></div></div><div class="public anchor" id="var-visit"><h3>visit</h3><div class="usage"><code>(visit t)</code></div><div class="doc"><pre class="plaintext">Generate the class bytecode from the provided type map. Returns a map
of the classes' :name and :bytes. Options:

  :name         of the class. Optional, but see below.

  :flags        seq of class/interface modifier flags (e.g., :final).
                See the `insn.util` namespace.

  :super        defaults to Object.

  :interfaces   sequence of interface types to extend/implement.

  :annotations  map or sequence of tuples, described below.

  :signature    generic type information - usually only ever needed
                for interop with Java libraries (reflection, etc.)

  :fields       sequence of field maps, described below.

  :methods      sequence of method maps, described below.

  :version      bytecode version given as a integer. For backwards
                compatibility, a float of major.minor may be given
                for versions 1.1 through 1.8.

  :source       string denoting the original source file - optional.

  :debug        string of arbitrary debug information - optional.

Each field and method can also be given :annotations and a :signature
as per above.

Some examples:

  (visit {:flags #{:public :interface}
          :name 'my.ns.Foo
          :methods [{:flags #{:public :abstract}
                     :name :my_method
                     :desc [:int]}]})
  (visit {:flags #{:public}
          :name 'my.ns.Bar
          :interfaces ['my.ns.Foo]
          :methods [{:flags #{:public}
                     :name :toString
                     :desc [String]
                     :emit [[:ldc "Bar"]
                            [:areturn]]}
                    {:flags #{:public}
                     :name :my_method
                     :desc [:int]
                     :emit [[:ldc 42]
                            [:ireturn]]}]})

Class instance/static fields are provided as maps. Options:

  :name   field name (required).

  :type   field type (required).

  :flags  seq of field modifier flags.

  :value  initial value. Only for primitive and String static fields,
          and if given, must be a corresponding Integer, Float, Long,
          Double, or String value.

Some example maps:

  {:flags #{:public :final}, :name :my_string, :type String}
  {:flags #{:static}, :name :some_number, :type :long, :value 42}

Class/interface methods, constructors, and static initializers are
provided as maps. Options:

  :name   method name (required). Can be either :init or :clinit,
          designating a constructor or the static initializer,
          respectively.

  :flags  seq of method modifier flags. Ignored for the static
          initializer.

  :desc   method parameter types and return type (specified last).
          Ignored for the static initializer, optional for
          constructors. For constructors, the method return type is
          forced to void if not explicitly specified as such.

  :emit   either a fn taking a MethodVisitor or a sequence of
          instructions to emit for the method (see `insn.op`).
          Optional if method is abstract.

Some example maps, :emit has been omitted for brevity:

  {:name :add_ints, :desc [:int :int :int]}
  {:flags #{:private}, :name :init, :desc [String :boolean :void]}
  {:name :clinit}

Additionally, methods may be given :parameter-annotations provided as
a map of {parameter-index annotations}.

If the class name is not package prefixed, the current namespace is
used as the resulting classes' package. If a name is not given, a
generated (gensym) class name is used, qualified by the current
namespace.

If the type does not define at least one constructor, and is not an
abstract type, a default, zero-argument constructor with default
access will be written that simply invokes the superclass constructor.

All annotations are provided as a map or sequence of tuples. Each key
is the Annotation name and each value is a map of elements. A non-map
value specifies a single element named :value as per java.

Annotation values are processed the same as in clojure.
See: <a href="https://clojure.org/reference/datatypes#_java_annotation_support">https://clojure.org/reference/datatypes#_java_annotation_support</a></pre></div></div><div class="public anchor" id="var-write"><h3>write</h3><div class="usage"><code>(write t)</code><code>(write t root)</code></div><div class="doc"><pre class="plaintext">Takes a map specifying a classes' :name and :bytes. Writes the class
bytes to a .class file. The file's directory is taken from its
package, its filename from its name, rooted at `root`.

If not given, `root` defaults to `*compile-path*`, or if not set, the
"java.io.tmpdir" property. If both of those are not set, a 'classes'
directory in the current directory is used.</pre></div></div></div></body></html>